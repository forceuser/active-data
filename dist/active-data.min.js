!function webpackUniversalModuleDefinition(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.activeData=t():e.activeData=t()}(this,function(){return function(e){function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}var t={};return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=1)}([function(e,t,r){"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"Manager",function(){return a});var n=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}(),a=function(){function Manager(e){_classCallCheck(this,Manager),this.$isObservableSymbol=Symbol("isObservable"),this.$registerRead=Symbol("registerRead"),this.$dataSource=Symbol("dataSource"),this.observables=new WeakMap,this.cache=new WeakMap,this.options={enabled:!0,immediateReaction:!1},this.callStack=[],this.reactions=[],this.setOptions(e)}return n(Manager,[{key:"setOptions",value:function setOptions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=Object.assign(this.options,e)}},{key:"makeObservable",value:function makeObservable(e){var t=this;if(!e)return e;if(this.isObservable(e))return e;var r=t.observables.get(e);if(!r){var n=new Map,a=function invalidateDeps(e){e.valid=!1,e.deps.forEach(function(e){return invalidateDeps(e)}),e.deps.clear()},o=function registerRead(r,a,o){function initParentData(){initParentData.initialized=!0,console.log("updates.parentData",i,i.parentData),null==i.parentData&&(i.parentData=new Map);var t=i.parentData.get(r);console.log("parentData REC",r,t),null==t?(t={protoParents:o,protoPos:new Set},t.protoPos.add(0),i.parentData.set(r,t)):t.protoParents.length<o.length&&(t.protoParents=o),s&&t.protoPos.add(o.length-1),console.log("regiter read",e,a,JSON.stringify(t.protoParents),JSON.stringify(Array.from(t.protoPos)))}var i=n.get(a);i||(i={records:new Set},n.set(a,i)),i.records.add(r);var s=!o,l=Object.getPrototypeOf(e);o?initParentData():o=[e];for(var c=[].concat(_toConsumableArray(o));null!=l;){var u=t.observables.get(l);if(c.push(l),null!=u){console.log("is observable proto"),u[t.$registerRead](r,a,[].concat(_toConsumableArray(c)));break}l=Object.getPrototypeOf(l)}};r=new Proxy(e,{get:function get(e,r){if(r===t.$isObservableSymbol)return!0;if(t.callStack.length){if(r===t.$registerRead)return o;o(t.callStack[t.callStack.length-1].record,r)}var n=e[r];return n===Object(n)&&"function"!=typeof n?t.makeObservable(n):n},set:function set(e,r,o){if(t.callStack&&t.callStack.length)throw new Error("Changing observable objects is restricted inside computed properties and reaction functions!");if(o!==e[r]||Array.isArray(e)&&"length"===r){e[r]=o;var i=n.get(r);i&&(i.parentData?i.records.forEach(function(t){var n=i.parentData.get(t);console.log("PARENT DATA",e,r,JSON.stringify(n.protoParents),JSON.stringify(Array.from(n.protoPos.values())));for(var o=!0,s=n.protoParents.length-2,l=s;l>=0&&(console.log("go go",l,s),!n.protoPos.has(l));l--)if(n.protoParents[l].hasOwnProperty(r)){o=!1,console.log("+++++DO NOT INVALIDATE");break}o&&(console.log("+++++INVALIDATE"),a(t))}):(console.log("+++++INVALIDATE BASIC"),i.records.forEach(function(e){return a(e)}))),n.delete(r),t.inRunSection||(t.options.immediateReaction?t.run():t.runDeferred())}return!0}}),t.observables.set(e,r)}return r}},{key:"makeUpdatable",value:function makeUpdatable(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this;return null==t&&(t=r),function(){var n=r.cache.get(t),a=void 0;if(n?a=n.get(e):(n=new Map,r.cache.set(t,n)),a||(a={valid:!1,value:void 0,deps:new Set},n.set(e,a)),a.computing)return void console.warn("Detected cross reference inside computed properties! undefined will be returned to prevent infinite loop");if(r.callStack.length&&a.deps.add(r.callStack[r.callStack.length-1].record),a.valid)return a.value;a.computing=!0,r.callStack.push({obj:t,call:e,record:a});try{var o=void 0;o=this?r.observables.get(this):r;var i=e.call(o,o);return a.valid=!0,a.value=i,i}finally{a.computing=!1,r.callStack.pop()}}}},{key:"makeComputed",value:function makeComputed(e,t,r,n){Object.defineProperty(e,t,{enumerable:!0,get:this.makeUpdatable(r,e),set:n})}},{key:"makeReaction",value:function makeReaction(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this,n=this.makeUpdatable(e);return r.reactions.push(n),t&&(this.options.immediateReaction?r.run():r.runDeferred()),{unregister:function unregister(){var e=r.reactions.indexOf(n);e>=0&&r.reactions.splice(e,1)},reaction:n}}},{key:"isObservable",value:function isObservable(e){return!0===e[this.$isObservableSymbol]}},{key:"run",value:function run(e){if(this.options.enabled){this.inRunSection=!0;try{"function"==typeof e&&e(),this.runScheduled=!1,this.reactions.forEach(function(e){return e()}),"function"==typeof this.onAfterRun&&this.onAfterRun()}finally{this.inRunSection=!1}}}},{key:"runDeferred",value:function runDeferred(e){var t=this;if(this.options.enabled){this.inRunSection=!0;try{this.runScheduled||(this.runScheduled=setTimeout(function(){return t.run()})),"function"==typeof e&&e()}finally{this.inRunSection=!1}}}}]),Manager}();a.default=new a,a.default.Manager=a,t.default=a.default},function(e,t,r){e.exports=r(0).default}])});
//# sourceMappingURL=active-data.min.js.map