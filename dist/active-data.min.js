!function webpackUniversalModuleDefinition(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.activeData=t():e.activeData=t()}(this,function(){return function(e){function __webpack_require__(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}var t={};return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,a){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=1)}([function(e,t,a){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),a.d(t,"Manager",function(){return i}),a.d(t,"observable",function(){return o}),a.d(t,"reaction",function(){return u}),a.d(t,"computed",function(){return c}),a.d(t,"updatable",function(){return l});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}(),i=function(){function Manager(e){_classCallCheck(this,Manager),this.$isObservableSymbol=Symbol("isObservable"),this.$registerRead=Symbol("registerRead"),this.$dataSource=Symbol("dataSource"),this.observables=new WeakMap,this.cache=new WeakMap,this.options={enabled:!0,immediateReaction:!1,watchKey:"$$watch",watchDeepKey:"$$watchDeep",dataSourceKey:"$$dataSource"},this.callStack=[],this.reactions=[],this.setOptions(e),this.observable=this.makeObservable.bind(this),this.reaction=this.makeReaction.bind(this),this.computed=this.makeComputed.bind(this),this.updatable=this.makeUpdatable.bind(this)}return r(Manager,[{key:"setOptions",value:function setOptions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=Object.assign(this.options,e)}},{key:"makeObservable",value:function makeObservable(e){var t=this;if(!e)return e;if(t.isObservable(e))return e;var a=t.observables.get(e);if(!a){var r=new Map,i=function invalidateDeps(e){e.valid&&(e.valid=!1,e.deps.forEach(function(e){return invalidateDeps(e)})),e.deps.clear()},o=function initUpdates(e){var t={updatableStates:new Set,updatableStateMap:new WeakMap};return r.set(e,t),t},u=!1,c=function registerRead(a,i,c){var l=i;if(i===t.options.watchDeepKey){if(u)return;u=!0,Object.keys(e).forEach(function(a){if("object"===n(e[a])){t.makeObservable(e[a])[t.options.watchDeepKey]}}),l=t.options.watchKey,u=!1}var s=r.get(l);s||(s=o(l)),s.updatableStates.add(a);var p=s.updatableStateMap.get(a);if(p||(p={},s.updatableStateMap.set(a,p)),a.uninit.set(e,function(e){s.updatableStates.delete(e),s.updatableStateMap.delete(e),0===s.updatableStates.size&&r.delete(l)}),c){var f=c[c.length-1];if(p.prototypes||(p.prototypes=new Map),p.prototypes.get(f))return;p.prototypes.set(f,c)}else c=[e],p.root=!0;for(var d=Object.getPrototypeOf(e);null!=d&&d!=Object.prototype;){var b=t.observables.get(d);if(c.unshift(d),null!=b&&b!==Object.prototype){b[t.$registerRead](a,i,c);break}d=Object.getPrototypeOf(d)}},l=function updateProperty(e,a){[a,t.options.watchKey].forEach(function(t){var n=r.get(t);n&&n.updatableStates.forEach(function(t){var r=n.updatableStateMap.get(t);if(r.root)i(t);else{Array.from(r.prototypes.values()).some(function(t){for(var n=t.indexOf(e)+1,r=t.length,i=!0,o=n;o<r;o++)if(t[o].hasOwnProperty(a)){i=!1;break}return i})&&i(t)}})}),t.inRunSection||(t.options.immediateReaction?t.run():t.runDeferred())};a=new Proxy(e,{get:function get(a,r,i){if(r===t.$isObservableSymbol)return!0;if(r===t.options.dataSourceKey)return e;var o=Object.getOwnPropertyDescriptor(a,r);if(o&&"function"==typeof o.get)return t.makeUpdatable(o.get,a).call(a);if(t.callStack.length){if(r===t.$registerRead)return c;c(t.callStack[t.callStack.length-1].updatableState,r)}if(r===t.options.watchKey||r===t.options.watchDeepKey)return i;var u=a[r];return"object"===(void 0===u?"undefined":n(u))?t.makeObservable(u):u},set:function set(e,a,n){if(t.callStack&&t.callStack.length)throw new Error("Changing observable objects is restricted inside computed properties and reaction functions!");return(n!==e[a]||Array.isArray(e)&&"length"===a)&&(e[a]=n,l(e,a)),!0},deleteProperty:function deleteProperty(e,t){return l(e,t),!0}}),t.observables.set(e,a)}return a}},{key:"makeUpdatable",value:function makeUpdatable(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e.updatableCall)return e;var a=this;null==t&&(t=a);var n=void 0,r=a.cache.get(t);if(r?n=r.get(e):(r=new Map,a.cache.set(t,r)),!n){var i={valid:!1,value:void 0,deps:new Set,uninit:new Map};n=function updatableFunction(){if(i.computing)return void console.warn('Detected cross reference inside computed properties! "undefined" will be returned to prevent infinite loop');if(a.callStack.length&&i.deps.add(a.callStack[a.callStack.length-1].updatableState),i.valid)return i.value;i.computing=!0,i.uninit.forEach(function(e){return e(i)}),i.uninit.clear(),a.callStack.push({obj:t,call:e,updatableState:i});try{var n=void 0;n=this?a.observables.get(this):a;var r=e.call(n,n);return i.valid=!0,i.value=r,r}finally{i.computing=!1,a.callStack.pop()}},n.updatableCall=e,r.set(e,n)}return n}},{key:"makeComputed",value:function makeComputed(e,t,a,n){Object.defineProperty(e,t,{enumerable:!0,get:this.makeUpdatable(a,e),set:n})}},{key:"makeReaction",value:function makeReaction(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this,n=this.makeUpdatable(e);return a.reactions.push(n),t&&(this.options.immediateReaction?a.run():a.runDeferred()),{unregister:function unregister(){var e=a.reactions.indexOf(n);e>=0&&a.reactions.splice(e,1)},reaction:n}}},{key:"isObservable",value:function isObservable(e){return!0===e[this.$isObservableSymbol]}},{key:"run",value:function run(e){if(this.options.enabled){this.inRunSection=!0;try{"function"==typeof e&&e(),this.runScheduled=!1,this.reactions.forEach(function(e){return e()}),"function"==typeof this.onAfterRun&&this.onAfterRun()}finally{this.inRunSection=!1}}}},{key:"runDeferred",value:function runDeferred(e){var t=this;if(this.options.enabled){this.inRunSection=!0;try{this.runScheduled||(this.runScheduled=setTimeout(function(){return t.run()})),"function"==typeof e&&e()}finally{this.inRunSection=!1}}}}]),Manager}();i.default=new i,i.default.Manager=i,t.default=i.default;var o=i.default.observable,u=i.default.reaction,c=i.default.computed,l=i.default.updatable},function(e,t,a){e.exports=a(0).default}])});
//# sourceMappingURL=active-data.min.js.map